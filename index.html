<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Media Platform</title>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-storage-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Global Styles */
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 0;
    }
    
    .container {
    width:98%;
    margin: 0 auto;
    padding:3px;
    }
    
    .post-card {
    border: 1px solid #ddd;
    margin-bottom:10px;
    padding: 10px;
    background: #fff;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .post-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    }
    
    .post-header img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
    }
    
    .post-user {
    display: flex;
    align-items: center;
    }
    
    .post-username {
    font-weight: bold;
    }
    
    .post-timestamp {
    font-size: 12px;
    color: #777;
    }
    
    .post-content {
    margin-top: 10px;
    }
    
    .post-photo {
    margin-top: 10px;
    background-size: cover;
    background-position: center;
    width: 100%;
    height: 370px;
    border-radius: 5px;
    }
    
    .post-footer {
    margin-top: 10px;
    display: flex;
    align-items: center;
    
    }
    
    .like-button {
    cursor: pointer;
    padding: 5px 10px;
    background-color: transparent;
    border: none;
    color: black;
    font-size: 22px;
    }
    
    .like-button.liked {
    color: red;
    }
    
    .like-count {
    background-color: #008CBA;
    color: white;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    text-align: center;
    line-height: 25px;
    }
    
    .three-dots {
    cursor: pointer;
    }
    
    .share-button {
    color: #555;
    cursor: pointer;
    margin-left:70%;
    }
    
    p {
    color:#444;
    word-wrap: break-word;
    }
    
    .profile {
    background :#ddd;
    padding :10px;
    text-decoration :none ;
    
    
    }
    
    
    
    
    
    /* Additional Styles for Auth Forms */
    #auth-section {
      text-align: center;
      margin-top: 150px;
    }
    #auth-text {
      margin-bottom: 20px;
    }
    #sign-in-form, #sign-up-form {
      display: none;
    }
    .auth-form{
      padding:10px;
      margin: 10px;
      width:86%;
      height:26px;
      border-radius :15px;
      border:1px solid #ddd;
      background:#efefef;
      outline:none;
      
    }
    
    #login-btn,#register-btn{
    padding:10px;
    margin: 5px;
    width:92%;
    height:40px;
    border-radius :15px;
    border:1px solid #ddd;
    background:#8d97f4;
    outline:none;
    
    }
    
   .logo-img{
   
   height:70px;
   width:70px;
   border-radius:50%;
   margin-bottom:50px;
   
   
   }
    
   .main-header,.main-header h2{
   
   display:flex;
   justify-content :space-between ;
   height:50px;
   align-items:center;
   }
    
    
    
   /**home profile ***/
    
    .profile-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    background: #fff;
    padding: 20px;
    border-radius: px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    
    transition: transform 0.3s;
    }
    
    
    
    
    
    .profile-details {
    display: flex;
    align-items: center;
    gap: 15px;
    }
    
    .profile-photo {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #ddd; /* লোড হওয়ার আগে ব্যাকগ্রাউন্ড */
    border: 2px solid #008CBA;
    cursor: pointer;
    object-fit: cover;
    }
    
    .profile-info {
    display: flex;
    flex-direction: column;
    }
    
    .profile-name {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    }
    
    .profile-email {
    font-size: 14px;
    color: #666;
    }
    
    .settings-icon {
    font-size: 20px;
    color: tomato;
    cursor: pointer;
    transition: color 0.3s;
    
    }
    
    .settings-con:hover {
    color: #008CBA;
    }
    
    a {
    text-decoration: none;
    color: inherit;
    }
    
    
    /*upload post css*/
    /* Post Section */
    .post-creation {
    margin: auto;
    width: 91%;
    max-width: 500px;
    background-color: #ffffff;
    padding: 15px;
    
    
    }
    
    .post-creation input[type="text"] {
    width: 94%;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ddd;
    margin-bottom: 10px;
    font-size: 16px;
    height:45px;
    }
    
    .post-creation .file-input-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    }
    
    .post-creation .file-input-container label {
    display: flex;
    align-items: center;
    background-color: #008cba;
    margin-top:7px;
    color: #ffffff;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s;
    }
    
    .post-creation .file-input-container label:hover {
    background-color: #005f7f;
    }
    
    .post-creation .file-input-container label i {
    margin-right: 5px;
    width:100px;
    
    }
    
    .post-creation input[type="file"] {
    display: none;
    
    }
    
    .post-creation button {
    width: 30%;
    
    padding: 1px;
    border: none;
    border-radius: 5px;
    background-color: #28a745;
    color: #ffffff;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
    }
    
    .post-creation button:hover {
    background-color: #1e7a34;
    }
    
    .success-message {
    text-align: center;
    color: #28a745;
    margin-top: 10px;
    display: none;
    }
    
    #post-image{
    
    width:170px;
    
    }
    .button-flex{
    
    display:flex;
    justify-content:space-between ;
    height:37px;
    }
    
   hr{
    margin-top:8px;
    border:2px solid #efefef;
    
    }
    
   .main{
   width:100%;
   
   }
   
  .news{
  margin:5px;
  
  text-align:center;
  color:#999;
  }
   
   
  #show-sign-up{
  
  color:red;
  
  } 
   
  </style>
</head>
<body>
  <div class="main">
  <!-- Auth Section -->
  <div id="auth-section">
    <div class="logo">
    <img class="logo-img" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTVxJL7A1V8XBXY7a2RVOyXgnghAyM57K4w1Q&usqp=CAU">
    </div>

    <!-- Sign In Form -->
    <div id="sign-in-form" style="display: block;">
      <input id="sign-in-email" type="email" placeholder="Enter Email" class="auth-form">
      <input id="sign-in-password" type="password" placeholder="Enter Password" class="auth-form"><br>
      <button id="login-btn" style="padding: 10px; margin: 5px; ; color: white;">Sign In</button>
    </div>

    <!-- Sign Up Form -->
    <div id="sign-up-form">
      <input id="sign-up-email" type="email" placeholder="Enter Email" class="auth-form">
      <input id="sign-up-password" type="password" placeholder="Enter Password" class="auth-form"><br>
      <button id="register-btn" style="padding: 10px; margin: 5px; background:tomato; color: white;">Sign Up</button>
    </div>
    
    <div id="auth-text">
    <p  id="auth-switch-text">Don't have an account? <a href="#" id="show-sign-up" >Sign Up</a></p>
    </div>
    
  </div>

  <!-- Home Section -->
  <div id="home-section" style="display: none; margin-top:12%;">
  <!-- Header -->
  <div class="main-header" style="position: fixed; top: 0; width:100%; background-color: #4267B2; color: white;padding-left:13px;">
<h2>  My clone</h2>
  <button id="logout-btn" style="background-color: #FF4D4D; color: white; padding-right:15px;">Logout</button>
  
   </div>
  
  <!---home profile sec--->
  
    <div class="profile-container">
    <div class="profile-details">
    <a href="profile.html">
    <img id="profile-photo" src="default-profile.png" alt="Profile Photo" class="profile-photo">
    </a>
    <div class="profile-info">
    <a href="profile.html">
    <div id="profile-name" class="profile-name">User Name</div>
    </a>
    <div id="profile-email" class="profile-email">example@example.com</div>
    </div>
    </div>
    <a href="settings.html">
    <i class="fas fa-cog settings-icon"></i>
    </a>
    </div>
       
<div class="post-creation">
    <input type="text" id="post-text" placeholder="What's on your mind?" />
   <div class="button-flex">
    
    <div class="file-input-container">
      <label for="post-image">
        <i class="fas fa-image"></i> Upload Image
      </label>
      <input type="file" id="post-image" accept="image/*" />
    
    </div>
    <button id="create-post" type="button">Post</button>
    
    
    </div>
    
    <div id="success-message" class="success-message">Upload Successful!</div>
    
  </div>
    
    <hr>
    
    
    
    <div class="container">
    <h2 class="news">News feeds</h2>
    <div id="posts-container">
    
    <!-- Posts will be dynamically added here -->
    </div>
    </div>
    
  </div>
  
  
  </div>
  
  
  
  

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBsz-82MDaibWnIBUpoykrZHyJW7UMedX8",
      authDomain: "movies-bee24.firebaseapp.com",
      databaseURL: "https://movies-bee24-default-rtdb.firebaseio.com",
      projectId: "movies-bee24",
      storageBucket: "movies-bee24.appspot.com",
      messagingSenderId: "1080659811750",
      appId: "1:1080659811750:web:c1ef7d4dacc3ab17edc367"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    const authSection = document.getElementById('auth-section');
    const signInForm = document.getElementById('sign-in-form');
    const signUpForm = document.getElementById('sign-up-form');
    const showSignUpBtn = document.getElementById('show-sign-up');
    const authSwitchText = document.getElementById('auth-switch-text');
    const signInEmail = document.getElementById('sign-in-email');
    const signInPassword = document.getElementById('sign-in-password');
    const signUpEmail = document.getElementById('sign-up-email');
    const signUpPassword = document.getElementById('sign-up-password');
    const loginBtn = document.getElementById('login-btn');
    const registerBtn = document.getElementById('register-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const userNameSpan = document.getElementById('user-name');
    const homeSection = document.getElementById('home-section');
    

    auth.onAuthStateChanged((user) => {
      if (user) {
        authSection.style.display = 'none';
        homeSection.style.display = 'block';
        userNameSpan.textContent = user.email;
      } else {
        authSection.style.display = 'block';
        homeSection.style.display = 'none';
      }
    });

    showSignUpBtn.addEventListener('click', () => {
      signUpForm.style.display = 'block';
      signInForm.style.display = 'none';
      authSwitchText.innerHTML = 'Already have an account? <a href="#" id="show-sign-in">Sign In</a>';
      document.getElementById('show-sign-in').addEventListener('click', () => {
        signUpForm.style.display = 'none';
        signInForm.style.display = 'block';
        authSwitchText.innerHTML = "Don't have an account? <a href='#' id='show-sign-up'>Sign Up</a>";
      });
    });

    loginBtn.addEventListener('click', () => {
      const email = signInEmail.value;
      const password = signInPassword.value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          signInEmail.value = '';
          signInPassword.value = '';
        })
        .catch((error) => alert(error.message));
    });

    registerBtn.addEventListener('click', () => {
      const email = signUpEmail.value;
      const password = signUpPassword.value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => {
          signUpEmail.value = '';
          signUpPassword.value = '';
        })
        .catch((error) => alert(error.message));
    });

    logoutBtn.addEventListener('click', () => {
      auth.signOut();
    });
    
    
    
    
   
    
  </script>
  
  
  
  <script type="module">
  // Firebase Configuration
  const firebaseConfig = {
  apiKey: "AIzaSyBsz-82MDaibWnIBUpoykrZHyJW7UMedX8",
  authDomain: "movies-bee24.firebaseapp.com",
  databaseURL: "https://movies-bee24-default-rtdb.firebaseio.com",
  projectId: "movies-bee24",
  storageBucket: "movies-bee24.appspot.com",
  messagingSenderId: "1080659811750",
  appId: "1:1080659811750:web:c1ef7d4dacc3ab17edc367"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();
  const storage = firebase.storage();
  
  // Audio for success message
  const successAudio = new Audio('https://www.soundjay.com/button/beep-07.mp3');
  
  // Create Post
  document.getElementById("create-post").addEventListener("click", () => {
  const postText = document.getElementById("post-text").value;
  const postImageFile = document.getElementById("post-image").files[0];
  const successMessage = document.getElementById("success-message");
  
  if (postText || postImageFile) {
  const newPostRef = db.ref('posts').push();
  const postData = {
  userId: auth.currentUser ? auth.currentUser.uid : "guest",
  text: postText,
  timestamp: Date.now(),
  };
  
  if (postImageFile) {
  const storageRef = storage.ref(`post_images/${newPostRef.key}`);
  const uploadTask = storageRef.put(postImageFile);
  
  uploadTask.on('state_changed', (snapshot) => {
  // Optionally show progress
  }, (error) => {
  console.error("Error uploading post image:", error);
  }, () => {
  uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
  postData.imageUrl = downloadURL;
  newPostRef.set(postData);
  displaySuccess(successMessage);
  });
  });
  } else {
  newPostRef.set(postData);
  displaySuccess(successMessage);
  }
  
  // Clear the input fields
  document.getElementById("post-text").value = '';
  document.getElementById("post-image").value = '';
  }
  });
  
  function displaySuccess(messageElement) {
  messageElement.style.display = 'block';
  successAudio.play();
  setTimeout(() => {
  messageElement.style.display = 'none';
  }, 3000);
  }
  </script>
  
  
  <script>
  document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('create-post').addEventListener('click', function() {
  setTimeout(function() {
  location.reload();
  }, 6000); // 3 সেকেন্ড
  });
  });
  </script>
  
  
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
  
  // Firebase configuration
  const firebaseConfig = {
  apiKey: "AIzaSyBsz-82MDaibWnIBUpoykrZHyJW7UMedX8",
  authDomain: "movies-bee24.firebaseapp.com",
  databaseURL: "https://movies-bee24-default-rtdb.firebaseio.com",
  projectId: "movies-bee24",
  storageBucket: "movies-bee24.appspot.com",
  messagingSenderId: "1080659811750",
  appId: "1:1080659811750:web:c1ef7d4dacc3ab17edc367"
  };
  
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);
  
  // Fetch user profile data
  auth.onAuthStateChanged((user) => {
  if (user) {
  const userId = user.uid;
  const userRef = ref(db, `users/${userId}`);
  
  get(userRef).then((snapshot) => {
  if (snapshot.exists()) {
  const userData = snapshot.val();
  document.getElementById('profile-photo').src = userData.profilePhoto || 'default-profile.png';
  document.getElementById('profile-name').textContent = userData.name || 'Anonymous';
  document.getElementById('profile-email').textContent = userData.email || 'No email provided';
  } else {
  console.error("User data not found!");
  }
  }).catch((error) => {
  console.error("Error fetching user data:", error);
  });
  } else {
  console.log("No user is logged in.");
  }
  });
  
  
  
  
  
  </script>
  
  
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
  import { getDatabase, ref, get, update, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
  
  const firebaseConfig = {
  apiKey: "AIzaSyBsz-82MDaibWnIBUpoykrZHyJW7UMedX8",
  authDomain: "movies-bee24.firebaseapp.com",
  databaseURL: "https://movies-bee24-default-rtdb.firebaseio.com",
  projectId: "movies-bee24",
  storageBucket: "movies-bee24.appspot.com",
  messagingSenderId: "1080659811750",
  appId: "1:1080659811750:web:c1ef7d4dacc3ab17edc367"
  };
  
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);
  
  function relativeTime(timestamp) {
  const now = Date.now();
  const diff = Math.floor((now - timestamp) / 1000);
  if (diff < 60) return `${diff} seconds ago`;
  if (diff < 3600) return `${Math.floor(diff / 60)} minutes ago`;
  if (diff < 86400) return `${Math.floor(diff / 3600)} hours ago`;
  return `${Math.floor(diff / 86400)} days ago`;
  }
  
  function loadPosts() {
  const postsRef = ref(db, 'posts');
  get(postsRef).then((snapshot) => {
  if (snapshot.exists()) {
  const postsContainer = document.getElementById('posts-container');
  postsContainer.innerHTML = '';
  
  // Posts কে টাইমস্ট্যাম্প অনুযায়ী সাজানো হচ্ছে
  const postsArray = [];
  snapshot.forEach((childSnapshot) => {
  postsArray.push({ id: childSnapshot.key, data: childSnapshot.val() });
  });
  
  // নতুন পোস্টগুলো উপরে দেখানোর জন্য সোর্ট করা
  postsArray.sort((a, b) => b.data.timestamp - a.data.timestamp);
  
  postsArray.forEach((postItem) => {
  const post = postItem.data;
  const postId = postItem.id;
  
  const postElement = document.createElement('div');
  postElement.classList.add('post-card');
  
  const userRef = ref(db, `users/${post.userId}`);
  get(userRef).then((userSnapshot) => {
  const userData = userSnapshot.val();
  const userName = userData?.name || 'Anonymous';
  const userProfilePhoto = userData?.profilePhoto || 'default-profile.png';
  
  postElement.innerHTML = `
  <div class="post-header">
  <div class="post-user">
  <img src="${userProfilePhoto}" alt="Profile Photo" />
  <div>
  <div class="post-username">${userName}</div>
  <div class="post-timestamp">${relativeTime(post.timestamp)}</div>
  </div>
  </div>
  <i class="fas fa-ellipsis-h three-dots"></i>
  </div>
  <hr>
  <div class="post-content"><p>${post.text || ''}</p></div>
  ${post.imageUrl ? `<div class="post-photo" style="background-image: url(${post.imageUrl});"></div>` : ''}
  <div class="post-footer">
  <button class="like-button ${post.likedBy && post.likedBy[auth.currentUser?.uid] ? 'liked' : ''}" onclick="likePost('${postId}')">
  <i class="fas fa-heart"></i>
  </button>
  <div class="like-count">${post.likeCount || 0}</div>
  <i class="fas fa-share-alt share-button" onclick="sharePost('${postId}')"></i>
  </div>
  `;
  });
  
  postsContainer.appendChild(postElement);
  
  const postRef = ref(db, `posts/${postId}`);
  onValue(postRef, (snapshot) => {
  const updatedPost = snapshot.val();
  const likeCount = updatedPost.likeCount || 0;
  const likedBy = updatedPost.likedBy || {};
  
  const likeButton = postElement.querySelector('.like-button');
  const likeCountElement = postElement.querySelector('.like-count');
  
  likeButton.classList.toggle('liked', likedBy[auth.currentUser?.uid]);
  likeCountElement.textContent = likeCount;
  });
  });
  } else {
  console.log("No posts found!");
  }
  }).catch((error) => {
  console.error("Error fetching posts:", error);
  });
  }
  
  window.likePost = function(postId) {
  const user = auth.currentUser;
  if (!user) return;
  
  const postRef = ref(db, `posts/${postId}`);
  get(postRef).then((snapshot) => {
  if (snapshot.exists()) {
  const post = snapshot.val();
  const userId = user.uid;
  
  const likedBy = post.likedBy || {};
  const likeCount = post.likeCount || 0;
  
  if (likedBy[userId]) {
  delete likedBy[userId];
  update(postRef, { likedBy, likeCount: likeCount - 1 });
  } else {
  likedBy[userId] = true;
  update(postRef, { likedBy, likeCount: likeCount + 1 });
  }
  }
  });
  };
  
  window.sharePost = function(postId) {
  alert(`Share functionality for post ${postId} will be implemented.`);
  };
  
  auth.onAuthStateChanged(() => loadPosts());
  
  // Firebase Authentication এবং Realtime Database ব্যবহার ধরে নিচ্ছি
  firebase.auth().onAuthStateChanged((user) => {
  if (user) {
  const userId = user.uid; // লগইন করা ইউজারের ID
  firebase.database().ref('users/' + userId).once('value').then((snapshot) => {
  const userName = snapshot.val()?.name; // নাম চেক করা
  if (!userName || userName.trim() === "") {
  // নাম সেভ না থাকলে update.html এ রিডাইরেক্ট করা
  window.location.href = 'update.html';
  }
  }).catch((error) => {
  console.error('Error checking user name:', error);
  });
  } else {
  console.log('User not logged in');
  }
  });
  
  
  </script>
  
  
  
  
  
</body>
</html>
